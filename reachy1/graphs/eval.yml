nodes:
  - id: reachy-client
    custom:
      source: ../nodes/reachy_client.py
      inputs:
        action: eval/action
        tick: dora/timer/millis/33
      outputs:
        - agent_pos

  - id: reachy-vision-client
    custom:
      source: ../nodes/reachy_vision_client.py
      inputs:
        tick: dora/timer/millis/33
      outputs:
        - cam_trunk

  - id: eval
    custom:
      # source: dynamic
      source: /home/aloha/Documents/lerobot/lerobot/scripts/eval.py
      args: -p /home/aloha/Documents/lerobot/check_felix/checkpoints/last/pretrained_model eval.n_episodes=1 eval.batch_size=1 env.episode_length=20000 policy.n_action_steps=100 
      # source: ../nodes/gym_dora_node.py
      inputs:
        agent_pos: reachy-client/agent_pos
        cam_trunk: reachy-vision-client/cam_trunk
        stop: keyboard/stop
      outputs:
        - action

  - id: plot
    custom:
      source: ../nodes/plot_node.py
      inputs:
        image: reachy-vision-client/cam_trunk
        action: eval/action
      envs:
        IMAGE_WIDTH: 480
        IMAGE_HEIGHT: 640

  # - id: dora-record
  # custom:
  # build: cargo install --git https://github.com/dora-rs/dora dora-record
  # source: dora-record
  # inputs:
  # observation.state: reachy-client/agent_pos
  # action: eval/action
  # observation.images.cam_trunk: cam_saver_trunk/saved_image
  # episode_index: keyboard/space

  - id: cam_saver_trunk
    custom:
      source: ../nodes/lerobot_webcam_saver.py
      inputs:
        image: reachy-vision-client/cam_trunk
        record_episode: keyboard/space
      outputs:
        - saved_image
      envs:
        CAMERA_NAME: observation.images.cam_trunk

  - id: keyboard
    custom:
      source: ../nodes/keyboard_node.py
      inputs:
        heartbeat: dora/timer/millis/20
      outputs:
        - space
        - failed
        - stop

  # - id: idefics2
  # operator:
  # python: ../nodes/idefics2_node_demo.py
  # inputs:
  # image:
  # source: reachy-vision-client/cam_trunk
  # queue_size: 1
  # text: whisper/text_llm
  # outputs:
  # - speak
  # - control

  # - id: whisper
  # custom:
  # source: ../nodes/whisper_node.py
  # inputs:
  # audio: dora/timer/millis/1000
  # outputs:
  # - text_llm

  # - id: parler
  # operator:
  # python: ../nodes/parler_node.py
  # inputs:
  # text:
  # source: idefics2/speak
  # queue_size: 1
